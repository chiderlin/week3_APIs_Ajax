<!DOCTYPE html>
<html>
    <head>
        <meta charset="UTF-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <title>台灣景點介紹</title>
        <link rel="stylesheet" href="index.css" type="text/css" media="all" />
        <script type="text/javascript">
            let title_list = [];
            let img_url = [];
            let count_views = 0;
            window.onload = function() {
                    let req = new XMLHttpRequest();
                    req.open("get","https://padax.github.io/taipei-day-trip-resources/taipei-attractions.json")
                    req.onload = function() { 
                        // 連線 json APIs
                        let raw_data = JSON.parse(this.response);
                        cleanData(raw_data);
                        renderImg();
                    }
                    req.send();
                    
                    let get_more_data = document.getElementById("getMoreData");  
                    get_more_data.addEventListener("click", renderImg);
                }
                // Module
                function cleanData(raw_data) {
                    raw_data = raw_data.result.results;
                    // titles 
                    raw_data.forEach(element => {
                        title_list.push(element.stitle);
                    });
                    
                    // ETL image URL
                    raw_data.forEach(element => {
                        let clean_img = element.file;
                        clean_img = clean_img.replaceAll("http", " http");
                        clean_img = clean_img.split(" ");
                        img_url.push(clean_img[1]);  
                    });
                }            
                
                // Views + Load More button
                function renderImg() {
                    // onload 8張圖片
                    const main = document.querySelector("main");
                    for(let i=0; i<2; i++) {
                        const container = document.createElement("div");
                        container.className = "container";
                        main.appendChild(container);
                        for (let j=0; j<4; j++) {
                            const box = document.createElement("div");
                            const img = document.createElement("img");
                            const h4 = document.createElement("h4");
                            box.className = "box";
                            img.setAttribute("src", img_url[count_views]);
                            h4.appendChild(document.createTextNode(title_list[count_views]));
                            count_views++;
                            container.appendChild(box);
                            box.appendChild(img);
                            box.appendChild(h4);
                        }
                    }
                }
        </script>
    </head>
    <body>
        <header>
            <div class="logo">My Website</div>
            <div class="blank"></div>
            <input type="checkbox" id=burger>
            <label for="burger">
                <img src="icon/burger.png" id="icon">
            </label>
            <ul class="menu">
                <li class="hover"><a href="">Item 1</a></li>
                <li class="hover"><a href="">Item 2</a></li>
                <li class="hover"><a href="">Item 3</a></li>
                <li class="hover"><a href="">Item 4</a></li>
            </ul>
            <div class="item">Item 1</div>
            <div class="item">Item 2</div>
            <div class="item">Item 3</div>
            <div class="item">Item 4</div>
        </header>
        <nav>
            <div class="welcome">Welcome to MyHome</div>
        </nav>
        <main>
        </main>
        <footer>
            <div>
                <button id="getMoreData">Load More</button>
                <p>Copyright© Chi 2021</p>
            </div>
        </footer>
    </body>
</html>